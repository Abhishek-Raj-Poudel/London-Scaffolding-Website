---
import MainLayout from "../../layouts/main.astro";
import { getCollection } from "astro:content";
import { Button } from "@/components/ui/button";
import { CTA } from "@/components/CTA";
import { Image } from "astro:assets";

const projects = await getCollection("projects");
const locations = ["All", ...new Set(projects.map((p) => p.data.location))];

const meta = {
  title: "Our Scaffolding Projects | London Scaffolding Case Studies",
  description:
    "Explore our portfolio of professional scaffolding projects across London, from commercial redevelopments to heritage restorations.",
};
---

<MainLayout content={meta}>
  {/* Hero Section */}
  <section class="bg-primary text-white py-24 border-b border-white/10">
    <div class="wrapper">
      <div class="max-w-4xl flex flex-col gap-6">
        <h1 class="typo-5xl">Our Projects</h1>
        <p class="typo-xl text-white/90 leading-relaxed max-w-2xl">
          Discover how we provide safe, reliable, and professional scaffolding
          solutions for diverse projects across London and the South East.
        </p>
      </div>
    </div>
  </section>

  {/* Projects Grid */}
  <section class="py-24 bg-slate-50 min-h-[600px]">
    {/* Filter Section */}

    <div class="wrapper">
      <div class="mb-10">
        <div class="flex flex-col gap-6">
          <h2
            class="text-sm font-bold uppercase tracking-widest text-slate-400"
          >
            Filter by Location
          </h2>
          <div class="flex flex-wrap gap-3" id="filter-buttons">
            {
              locations.map((location) => (
                <button
                  data-filter={location}
                  class:list={[
                    "px-6 py-2 rounded-full border transition-all duration-300 font-medium text-sm",
                    location === "All"
                      ? "bg-primary border-primary text-white shadow-md active-filter"
                      : "bg-white border-slate-200 text-slate-600 hover:border-primary hover:text-primary",
                  ]}
                >
                  {location}
                </button>
              ))
            }
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 gap-12" id="projects-grid">
        {
          projects.map((project) => (
            <a
              class="group flex flex-col gap-5 project-card transition-all duration-500"
              href={`/projects/${project.slug}`}
              data-location={project.data.location}
            >
              <div class="relative h-120 overflow-hidden rounded-2xl transition-all duration-500">
                <Image
                  src={project.data.image}
                  alt={project.data.title}
                  class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                />
                <div class="absolute top-4 left-4 bg-primary text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-widest shadow-lg">
                  {project.data.location}
                </div>
              </div>
              <div class="flex flex-col md:flex-row justify-between items-start gap-8">
                <div class="flex flex-col gap-3">
                  <h3 class="typo-2xl font-bold group-hover:text-primary transition-colors">
                    {project.data.title}
                  </h3>
                  <p class="typo-lg text-muted-foreground leading-relaxed line-clamp-2 max-w-3xl">
                    {project.data.description}
                  </p>
                </div>
                <Button
                  variant="link"
                  className="p-0 text-primary font-bold hover:no-underline flex items-center gap-2 group/btn h-auto mt-1"
                >
                  View Case Study
                  <span class="group-hover:translate-x-1 transition-transform">
                    â†’
                  </span>
                </Button>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>

  <CTA
    title="Have a similar project in mind?"
    description="Contact our expert team today for a technical consultation and a free, no-obligation quote."
    buttonText="Get a Free Quote"
    phoneText="020 XXXX XXXX"
  />
</MainLayout>

<script>
  function initFilters() {
    const buttons = document.querySelectorAll("#filter-buttons button");
    const cards = document.querySelectorAll(".project-card");

    buttons.forEach((button) => {
      button.addEventListener("click", () => {
        const filter = button.getAttribute("data-filter");

        // Update active state of buttons
        buttons.forEach((btn) => {
          btn.classList.remove(
            "bg-primary",
            "border-primary",
            "text-white",
            "shadow-md",
            "active-filter",
          );
          btn.classList.add("bg-white", "border-slate-200", "text-slate-600");
        });

        button.classList.add(
          "bg-primary",
          "border-primary",
          "text-white",
          "shadow-md",
          "active-filter",
        );
        button.classList.remove(
          "bg-white",
          "border-slate-200",
          "text-slate-600",
        );

        // Filter cards
        cards.forEach((card) => {
          const location = card.getAttribute("data-location");
          if (filter === "All" || location === filter) {
            (card as HTMLElement).style.display = "flex";
            setTimeout(() => {
              (card as HTMLElement).style.opacity = "1";
              (card as HTMLElement).style.transform = "translateY(0)";
            }, 10);
          } else {
            (card as HTMLElement).style.opacity = "0";
            (card as HTMLElement).style.transform = "translateY(20px)";
            setTimeout(() => {
              (card as HTMLElement).style.display = "none";
            }, 500);
          }
        });
      });
    });
  }

  // Initialize on page load and after view transitions
  initFilters();
  document.addEventListener("astro:after-swap", initFilters);
</script>
